<div class="profile-page">
  <div class="container py-5">
    <div class="row">
      <div class="col-lg-8 mx-auto">
        <div class="card shadow-lg">
          <div class="card-header bg-primary text-white">
            <h3 class="mb-0"><i class="fa fa-user me-2"></i>My Profile</h3>
          </div>
          <div class="card-body p-4">
            <div class="alert alert-info mb-4 d-flex justify-content-between align-items-center">
              <div>
                <i class="fa fa-dashboard me-2"></i>
                Access your dashboard to manage bookings and account settings.
              </div>
              <a routerLink="/profile/dashboard" class="btn btn-outline-primary btn-sm">Go to Dashboard</a>
            </div>
            <!-- Profile Image Section -->
            <div class="text-center mb-4">
              <div class="profile-image-container position-relative d-inline-block">
                <img [src]="currentUser?.profileImage || 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=150&h=150&fit=crop&crop=face'" 
                     alt="Profile Picture" 
                     class="rounded-circle border border-4 border-white shadow-lg" 
                     style="width: 120px; height: 120px; object-fit: cover;">
                <div class="status-indicator bg-success position-absolute bottom-0 end-0 rounded-circle border border-3 border-white" 
                     style="width: 20px; height: 20px;"></div>
                <input type="file" 
                       id="profileImage" 
                       accept="image/*" 
                       (change)="onImageUpload($event)" 
                       style="display: none;">
                <label for="profileImage" class="btn btn-sm btn-outline-primary position-absolute top-0 end-0 rounded-circle" 
                       style="width: 30px; height: 30px; padding: 0; line-height: 30px;">
                  <i class="fa fa-camera fa-sm"></i>
                </label>
              </div>
              <h4 class="mt-3 mb-1">{{ currentUser?.name }}</h4>
              <p class="text-muted small mb-2">
                <i class="fa fa-check-circle text-success me-1"></i>
                Verified Account • Member for {{ getAccountAge() }}
              </p>
              
              <!-- Profile Completion -->
              <div class="profile-completion mb-3">
                <div class="d-flex justify-content-between align-items-center mb-1">
                  <small class="text-muted">Profile Completion</small>
                  <small class="text-muted">{{ getProfileCompletion() }}%</small>
                </div>
                <div class="progress" style="height: 6px;">
                  <div class="progress-bar bg-success" 
                       [style.width.%]="getProfileCompletion()" 
                       role="progressbar"></div>
                </div>
              </div>
            </div>

            <!-- Success Message -->
            <div class="alert alert-success alert-dismissible fade show" 
                 *ngIf="showSuccessMessage" 
                 role="alert">
              <i class="fa fa-check-circle me-2"></i>
              Profile updated successfully!
              <button type="button" class="btn-close" (click)="showSuccessMessage = false"></button>
            </div>

            <!-- Profile Statistics -->
            <div class="row g-3 mb-4">
              <div class="col-md-3">
                <div class="stat-card text-center p-3 bg-light rounded-3">
                  <i class="fa fa-calendar-check text-primary fa-2x mb-2"></i>
                  <h5 class="mb-1">{{ profileStats.totalBookings }}</h5>
                  <small class="text-muted">Total Bookings</small>
                </div>
              </div>
              <div class="col-md-3">
                <div class="stat-card text-center p-3 bg-light rounded-3">
                  <i class="fa fa-check-circle text-success fa-2x mb-2"></i>
                  <h5 class="mb-1">{{ profileStats.completedBookings }}</h5>
                  <small class="text-muted">Completed</small>
                </div>
              </div>
              <div class="col-md-3">
                <div class="stat-card text-center p-3 bg-light rounded-3">
                  <i class="fa fa-dollar-sign text-warning fa-2x mb-2"></i>
                  <h5 class="mb-1">AED {{ profileStats.totalSpent | number }}</h5>
                  <small class="text-muted">Total Spent</small>
                </div>
              </div>
              <div class="col-md-3">
                <div class="stat-card text-center p-3 bg-light rounded-3">
                  <i class="fa fa-star text-info fa-2x mb-2"></i>
                  <h5 class="mb-1">4.8★</h5>
                  <small class="text-muted">Avg Rating</small>
                </div>
              </div>
            </div>

            <form [formGroup]="profileForm" (ngSubmit)="onSubmit()">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="name" class="form-label">Full Name</label>
                  <input
                    type="text"
                    id="name"
                    formControlName="name"
                    class="form-control"
                    [class.is-invalid]="getFieldError('name')"
                    [readonly]="!isEditing">
                  <div class="invalid-feedback d-block" *ngIf="getFieldError('name')">
                    {{ getFieldError('name') }}
                  </div>
                </div>

                <div class="col-md-6 mb-3">
                  <label for="email" class="form-label">Email Address</label>
                  <input
                    type="email"
                    id="email"
                    formControlName="email"
                    class="form-control"
                    [class.is-invalid]="getFieldError('email')"
                    [readonly]="!isEditing">
                  <div class="invalid-feedback d-block" *ngIf="getFieldError('email')">
                    {{ getFieldError('email') }}
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="phone" class="form-label">Phone Number</label>
                  <input
                    type="tel"
                    id="phone"
                    formControlName="phone"
                    class="form-control"
                    [class.is-invalid]="getFieldError('phone')"
                    [readonly]="!isEditing">
                  <div class="invalid-feedback d-block" *ngIf="getFieldError('phone')">
                    {{ getFieldError('phone') }}
                  </div>
                </div>

                <div class="col-md-6 mb-3">
                  <label class="form-label">Account Type</label>
                  <input
                    type="text"
                    class="form-control"
                    [value]="currentUser?.role === 'employer' ? 'Looking for a maid' : 'Looking for work as a maid'"
                    readonly>
                </div>
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">Member Since</label>
                  <input
                    type="text"
                    class="form-control"
                    [value]="currentUser?.createdAt | date:'mediumDate'"
                    readonly>
                </div>

                <div class="col-md-6 mb-3">
                  <label class="form-label">Account Status</label>
                  <input
                    type="text"
                    class="form-control"
                    [value]="currentUser?.isActive ? 'Active' : 'Inactive'"
                    readonly>
                </div>
              </div>

              <div class="d-flex gap-2 mt-4">
                <button
                  *ngIf="!isEditing"
                  type="button"
                  class="btn btn-primary"
                  (click)="toggleEdit()">
                  <i class="fa fa-edit me-2"></i>Edit Profile
                </button>
                
                <button
                  *ngIf="isEditing"
                  type="submit"
                  class="btn btn-success"
                  [disabled]="isLoading">
                  <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
                  <i *ngIf="!isLoading" class="fa fa-save me-2"></i>
                  {{ isLoading ? 'Saving...' : 'Save Changes' }}
                </button>
                
                <button
                  *ngIf="isEditing"
                  type="button"
                  class="btn btn-secondary"
                  (click)="toggleEdit()">
                  <i class="fa fa-times me-2"></i>Cancel
                </button>
              </div>
            </form>

            <!-- Additional Actions -->
            <div class="row mt-4">
              <div class="col-12">
                <div class="card border-0 bg-light">
                  <div class="card-body">
                    <h6 class="card-title mb-3">Account Actions</h6>
                    <div class="row g-2">
                      <div class="col-md-4">
                        <button class="btn btn-outline-warning w-100" (click)="changePassword()">
                          <i class="fa fa-key me-2"></i>Change Password
                        </button>
                      </div>
                      <div class="col-md-4">
                        <button class="btn btn-outline-info w-100" (click)="exportProfile()">
                          <i class="fa fa-download me-2"></i>Export Data
                        </button>
                      </div>
                      <div class="col-md-4">
                        <button class="btn btn-outline-danger w-100" (click)="deleteAccount()">
                          <i class="fa fa-trash me-2"></i>Delete Account
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
